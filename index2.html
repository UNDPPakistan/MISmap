</head>
  <body>

<div class ="col-sm-4 col-md-offset4" id="loading">
        <h1>Loading... (~2.5MB)</h1><small>Does not work on IE8 or older</small>
</div>

<div class="container" id="dashboard">
	<div class="row">
        	<div class="col-lg-4">
          		<div class="row">
            <h3>RAHA MIS -Dashboard</h3>
            
                    		<div class="col-xs-3"> <a class="reset btn btn-primary btn-sm" id="reset" href="javascript:dc.filterAll();dc.redrawAll();">Reset All</a> 
							</div>

          	</div>  
          
          	<div class="row">
           		 <div id="Benefi" class="col-xs-6">
              <h4>Beneficiaries </h4>
           		 </div>
            		<div id="Organi" class="col-xs-6">
              <h4>Organizations</h4>
           		 </div>
         	 </div>

         
	</div>
</div>
        <div id="map" class="col-lg-8">
          <h3>Map (Where)</h3><p><a href="javascript:TehsilMapShow();">TEHSIL</a> - District</p>
        </div>
        <div id="map2" class="col-lg-8">
          <h3>Map (Where)</h3><p>TEHSIL - <a href="javascript:DistrictMapShow();">District</a></p>
        </div>            
      </div>
      Created by Asela Bandara  
    </div>
	/**********************************************/
	 <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46399763-1']);
        _gaq.push(['_trackPageview']);
	/****************************************************************/
		function DistrictMapShow(){
            $('#map2').hide();           
            $('#map').show();
            map2_chart.filterAll();
            dc.redrawAll();
        }
        
        function TehsilMapShow(){
            $('#map').hide();
            $('#map2').show();
        }
        $('#dashboard').hide();
        $('#map').hide();
		
		
        var Benefi_chart = dc.pieChart("#Benefi");
        var Organi_chart = dc.pieChart("#Organi");
        var map_chart = dc.geoChoroplethChart("#map");
        var map2_chart = dc.geoChoroplethChart("#map2");

  d3.csv("data/raha_data.csv", function(csv_data){
            var cvsdata = crossfilter(csv_data);
			


// Reshape the data 
var cfB = new Array();
cvsdata.forEach(function (expB) {
    cfB.push({ Category: "Local", Value: expB.Local_Beneficiaries });
    cfB.push({ Category: "Afghan", Value: expB.Afghan_Beneficiaries });
   
});

var cfO = new Array();
cvsdata.forEach(function (expO) {
    cfO.push({ Category: "COs", Value: expO.CO_formed });
    cfO.push({ Category: "VOs", Value: expO.VO_formed });
    cfO.push({ Category: "LSOs", Value: expO.LSO_ormed });
});
// Setup crossfilter

var ndxB = crossfilter(cfB);
var categoryDim = ndxB.dimension(function (d) { return d.Category; });
var valueSumGroup = categoryDim.group().reduceSum(function (d) { return d.Value; });

var ndxO = crossfilter(cfO);
var categoryDimO = ndxO.dimension(function (d) { return d.Category; });
var valueSumGroupO = categoryDimO.group().reduceSum(function (d) { return d.Value; });

 var cf.tcode = cf.dimension(function(d) { return d.TEHSIL_C; });
		 var tcode = cf.tcode.group();
		  
		 var cf.pcode = cf.dimension(function(d) { return d.DISTRICT_C; });
		 var pcode = cf.pcode.group();     
          var all = cf.groupAll();
// Create the chart


var pieChartB = dc.pieChart("#Benefi");
pieChartB.dimension(categoryDim).group(valueSumGroup).radius(60)
;
var pieChartO = dc.pieChart("#Organi");
pieChartO.dimension(categoryDimO).group(valueSumGroupO).radius(60)
;
.group(all);
                            
            d3.json("data/Pakl_districs.geojson", function (districsJSON) {
                
                map_chart.width(660).height(600)
                    .dimension(cf.pcode)
                    .group(pcode)
                    .colors(['#AAAAAA', '#CB181D'])
                    .colorDomain([0, 1])
                    .colorAccessor(function (d) {
                        if(d>0){
                            return 1;
                        } else {
                            return 0;
                        }
                    })
                    .overlayGeoJson(districsJSON.features, "District", function (d) {
                        return d.properties.DISTRICT_C;
                    })
                    .projection(d3.geo.mercator().center([124.5,12]).scale(4500))
                    .title(function (d) {
                        return "District: " + pcode2prov[d.key];
                    });
                    
                    d3.json("data/Pakl_tehsil.geojson", function (tehsilJSON){
                        map2_chart.width(660).height(600)
                            .dimension(cf.tcode)
                            .group(tcode)
                            .colors(['#AAAAAA', '#CB181D'])
                            .colorDomain([0, 1])
                            .colorAccessor(function (d) {
                                if(d>0){
                                    return 1;
                                } else {
                                    return 0;
                                }
                            })
                            .overlayGeoJson(tehsilJSON.features, "Tehsils", function (d) {
                                return d.properties.TEHSIL_C;
                            })
                            .projection(d3.geo.mercator().center([124.5,12]).scale(4500))
                            .title(function (d) {
                                return "Tehsils: " + tcode2mun[d.key];
                            });
                            $('#loading').hide();
                            $('#dashboard').show();
                            dc.renderAll();
                            
                    });                    
                });            
        });
    </script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>
